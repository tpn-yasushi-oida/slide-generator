# まじん式スライドジェネレーター セットアップガイド

## 📋 概要

まじん式スライドジェネレーターは、Gemini AI を活用してGoogle風デザインのプレゼンテーションを自動生成するWebアプリです。

## 🚀 セットアップ手順

### 1. Google Apps Script プロジェクトの作成

1. [Google Apps Script](https://script.google.com/) にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「まじん式スライドジェネレーター」に変更

### 2. ファイルの配置

以下のファイルをGoogle Apps Scriptプロジェクトに追加してください：

#### main.gs
- メイン処理ファイル
- `main.gs` の内容をコピー&ペースト

#### callGemini.gs
- Gemini API呼び出しモジュール（構造化出力対応）
- `callGemini.gs` の内容をコピー&ペースト

#### majin_slide_generator.gs
- スライド生成エンジン
- `majin_slide_generator.gs` の内容をコピー&ペースト

#### index.html
- ユーザーインターフェース
- HTMLファイルとして追加し、`index.html` の内容をコピー&ペースト

### 3. Gemini API認証の設定

まじん式スライドジェネレーターは2つの認証方式をサポートします：

#### 方式1: Direct API（推奨・簡単）

1. [Google AI Studio](https://makersuite.google.com/app/apikey) にアクセス
2. 新しいAPIキーを作成
3. Google Apps Scriptの「プロジェクトの設定」→「スクリプト プロパティ」で設定
   - プロパティ: `GEMINI_API_KEY`
   - 値: 作成したAPIキー

#### 方式2: Vertex AI（高度・企業向け）

1. Google Cloud Consoleでサービスアカウントを作成
2. Vertex AI権限を付与
3. 秘密鍵をJSON形式でダウンロード
4. Google Apps Scriptの「プロジェクトの設定」→「スクリプト プロパティ」で設定
   - `PROJECT_ID`: Google CloudプロジェクトID
   - `REGION`: リージョン（例: us-central1）
   - `CLIENT_EMAIL`: サービスアカウントのメールアドレス
   - `PRIVATE_KEY`: 秘密鍵（改行は\\nで置換）
   - `GEMINI_MODEL`: モデル名（例: gemini-2.0-flash-exp）

**注意**: どちらか一方の設定で動作します。両方設定した場合はVertex AIが優先されます。

### 4. 必要な権限の設定

Google Apps Scriptが以下のサービスにアクセスできるよう権限を付与：
- Google Slides API
- UrlFetch (外部API呼び出し用)
- Properties Service (設定管理用)

### 5. Webアプリとしてデプロイ

1. 「デプロイ」→「新しいデプロイ」をクリック
2. 「タイプ」で「ウェブアプリ」を選択
3. 設定：
   - **実行者**: 自分 (your-email@gmail.com)
   - **アクセス権限**: 「すべてのユーザー」
4. 「デプロイ」をクリック
5. 表示されたWebアプリURLを保存

## 🧪 テスト手順

### 事前テスト

#### 1. 設定診断
Google Apps Scriptエディタで以下の関数を実行：
```javascript
diagnoseSettings()
```
設定状況とエラーがないか確認

#### 2. Gemini接続テスト  
```javascript
testGeminiConnection()
```
Gemini APIとの接続と構造化出力をテスト

### 基本機能テスト

#### 1. おまかせ生成テスト
```
入力例:
プレゼンテーション内容: "生成AIの基礎知識"
詳細設定: "初心者向け、10分程度の発表用"

期待結果:
- タイトルスライド
- アジェンダ
- 3-4つの章（セクション）
- 各章に2-3枚の本文スライド
- クロージング
- 合計8-15枚程度
```

#### 2. カスタム生成テスト
```
入力例:
プレゼンテーション内容: 
"プロジェクト進捗報告
1. 現在の状況
   - 完了タスク: 設計、開発フェーズ1
   - 進行中: テスト、ドキュメント作成
2. 課題と対策
   - スケジュール遅延: リソース追加で対応
   - 品質保証: テスト強化
3. 今後の予定
   - 来月: リリース準備
   - 来々月: 本格運用開始"

詳細設定: "役員会議用、15分程度"

期待結果:
- 構造化された内容
- 進捗表示（progressスライド）
- 比較表示（課題と対策）
- タイムライン（今後の予定）
```

### エラーハンドリングテスト

#### 1. 空入力テスト
- プレゼンテーション内容を空白で送信
- 適切なエラーメッセージが表示されること

#### 2. API接続エラーテスト
- APIキーを無効にして実行
- エラーメッセージが表示されること

#### 3. 長時間処理テスト
- 複雑な内容で生成時間を確認
- タイムアウト処理が適切に動作すること

## 🔧 トラブルシューティング

### よくある問題と解決方法

#### 1. "Gemini API接続用の認証情報が設定されていません" エラー
**原因**: Direct APIキーとVertex AI認証情報の両方が未設定
**解決**: 
- Direct API: スクリプトプロパティで`GEMINI_API_KEY`を設定
- Vertex AI: `PROJECT_ID`, `CLIENT_EMAIL`, `PRIVATE_KEY`を設定

#### 2. "アクセストークンの取得に失敗しました" エラー
**原因**: Vertex AI認証情報が不正
**解決**: 
- サービスアカウントの権限を確認
- 秘密鍵の形式を確認（\\nエスケープ）
- プロジェクトIDが正しいか確認

#### 2. "権限がありません" エラー
**原因**: Google Slides APIの権限不足
**解決**: 初回実行時に権限を許可

#### 3. "生成されたプレゼンテーションが見つかりません" エラー
**原因**: Google Driveの容量不足またはアクセス権限
**解決**: ドライブ容量を確認、権限を再設定

#### 4. レスポンスが遅い
**原因**: Gemini APIの負荷またはネットワーク遅延
**解決**: 時間をおいて再実行

### デバッグ方法

1. **ログ確認**
   ```javascript
   // Google Apps Scriptの実行ログを確認
   console.log('デバッグ情報');
   Logger.log('ログ出力');
   ```

2. **段階的テスト**
   - まずGemini API呼び出し部分を単体テスト
   - 次にスライド生成部分を単体テスト
   - 最後に全体統合テスト

3. **JSON構造確認**
   ```javascript
   // 生成されたslideDataの構造を確認
   console.log(JSON.stringify(slideData, null, 2));
   ```

## 📊 パフォーマンス最適化

### 推奨設定

1. **Gemini APIパラメータ**
   - temperature: 0.7 (創造性とくり返性のバランス)
   - topP: 0.9 (多様性確保)
   - topK: 40 (選択肢の制限)

2. **スライド枚数制限**
   - 最大50枚（GAS実行時間制限対応）
   - 推奨10-20枚（プレゼンテーション効果最大化）

3. **画像処理**
   - 50MB未満、25MP以下
   - PNG/JPEG/GIF/WebP形式のみ

## 🔒 セキュリティ注意事項

1. **APIキー管理**
   - スクリプトプロパティで管理（コードに直接記載しない）
   - 定期的なキーローテーション

2. **アクセス制限**
   - 必要に応じて特定ドメインからのアクセスのみ許可
   - 社内利用の場合は組織アカウントで制限

3. **データ保護**
   - 入力データのログ保存は最小限に
   - 機密情報の入力は避ける

## 📈 使用量監視

### 監視すべき指標

1. **API使用量**
   - Gemini API呼び出し回数
   - レスポンス時間

2. **リソース使用量**
   - GASの実行時間
   - Google Driveの容量

3. **エラー率**
   - API呼び出し失敗率
   - スライド生成失敗率

## 🎯 本番運用準備

### チェックリスト

- [ ] すべてのテストが成功
- [ ] APIキーが適切に設定
- [ ] エラーハンドリングが正常動作
- [ ] パフォーマンスが許容範囲内
- [ ] セキュリティ設定が適切
- [ ] ユーザーマニュアルが準備済み

### デプロイ前確認

1. **機能確認**
   - おまかせ生成・カスタム生成両方の動作確認
   - 様々な入力パターンでのテスト
   - エラーケースの動作確認

2. **品質確認**
   - 生成されるスライドのデザイン品質
   - 内容の論理性と一貫性
   - スピーカーノートの適切性

3. **運用確認**
   - 同時アクセス時の動作
   - 長時間運用時の安定性
   - 負荷分散の必要性

以上でセットアップは完了です。問題が発生した場合は、ログを確認して段階的にデバッグを行ってください。
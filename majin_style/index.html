<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ã¾ã˜ã‚“å¼ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  </head>
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0..1,-25..0"
  />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400&family=Material+Symbols+Outlined&family=Reddit+Sans:wght@400;500&display=swap"
    rel="stylesheet"
  />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Helvetica Neue", Arial, sans-serif;
      color: #333;
      padding: 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
      color: white;
    }

    header h1 {
      font-family: "Reddit Sans", sans-serif;
      font-size: 2.2rem;
      font-weight: 500;
      letter-spacing: 0.1rem;
      margin: 0;
      padding-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    header .subtitle {
      font-size: 1.1rem;
      opacity: 0.9;
      font-weight: 400;
    }

    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 35px;
      text-align: center;
      font-size: 0.875rem;
      color: rgba(255,255,255,0.8);
      padding: 0.5rem 0;
      z-index: 10;
      background: rgba(0,0,0,0.1);
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
    }

    .container h2 {
      padding: 10px 0 30px 0;
      text-align: center;
      color: #4a5568;
      font-size: 1.4rem;
      font-weight: 400;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-label {
      font-size: 1rem;
      font-weight: 500;
      color: #2d3748;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    textarea {
      width: 100%;
      padding: 18px 24px;
      font-size: 0.95rem;
      outline: none;
      background: #f8f9fa;
      transition: all 0.3s ease;
      color: #333;
      border: 2px solid #e2e8f0;
      border-radius: 15px;
      line-height: 1.6;
      resize: vertical;
    }
    
    textarea:focus {
      border-color: #667eea;
      background: #ffffff;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .btn-area {
      text-align: center;
      vertical-align: middle;
      margin-top: 10px;
    }

    .submit-btn {
      height: 55px;
      width: 200px;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      border-radius: 15px;
      font-size: 1.05rem;
      cursor: pointer;
      transition: all 0.3s ease;
      letter-spacing: 0.5px;
      margin: 10px 15px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
    }
    
    .submit-btn:active {
      transform: translateY(0);
    }


    #link-to-slide {
      width: 300px;
      background: linear-gradient(135deg, #ffdd00 0%, #ffa500 100%);
      color: #333;
      font-weight: bold;
      margin-top: 30px;
      display: none;
      box-shadow: 0 4px 15px rgba(255, 221, 0, 0.4);
    }

    #link-to-slide:hover {
      box-shadow: 0 8px 25px rgba(255, 221, 0, 0.6);
    }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
    }

    .loading-content {
      text-align: center;
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 6px solid rgba(102, 126, 234, 0.2);
      border-top: 6px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    #loading p {
      margin-top: 20px;
      font-size: 1.1rem;
      color: #333;
      font-weight: 500;
    }

    #loading button {
      margin-top: 25px;
      padding: 12px 24px;
      background-color: #ff5722;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }

    #loading button:hover {
      background-color: #e64a19;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    /* ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ */
    #custom-alert-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      z-index: 999;
      display: none;
      backdrop-filter: blur(5px);
    }

    #custom-alert {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      max-width: 400px;
      width: 90%;
    }

    #custom-alert .alert-content {
      text-align: center;
    }

    #custom-alert button {
      margin-top: 25px;
      padding: 12px 20px;
      background-color: #667eea;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    #custom-alert button:hover {
      background-color: #5a67d8;
    }

    .feature-badge {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      margin-left: 8px;
    }

    .description-box {
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      padding: 16px 20px;
      margin-bottom: 20px;
      border-radius: 0 10px 10px 0;
    }

    .description-box h3 {
      color: #2d3748;
      margin-bottom: 8px;
      font-size: 1.1rem;
    }

    .description-box p {
      color: #4a5568;
      line-height: 1.5;
      margin: 4px 0;
    }
  </style>
  <body>
    <header>
      <h1>ã¾ã˜ã‚“å¼ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
      <p class="subtitle">AIé§†å‹•ã§ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªGoogleã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆ</p>
    </header>
    <div class="container">
      <h2>ã¾ã˜ã‚“å¼ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ ãƒ†ã‚¹ãƒˆ</h2>
      
      <div class="description-box">
        <h3>ğŸ¯ ã¾ã˜ã‚“å¼ã®ç‰¹å¾´</h3>
        <p>â€¢ <strong>Googleé¢¨ãƒ‡ã‚¶ã‚¤ãƒ³:</strong> ç¾ã—ãçµ±ä¸€ã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</p>
        <p>â€¢ <strong>å¤šå½©ãªè¡¨ç¾:</strong> æ¯”è¼ƒã€ãƒ—ãƒ­ã‚»ã‚¹ã€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã€ã‚«ãƒ¼ãƒ‰ãªã©è±Šå¯Œãªãƒ‘ã‚¿ãƒ¼ãƒ³</p>
        <p>â€¢ <strong>ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒˆ:</strong> ç™ºè¡¨åŸç¨¿ã‚‚è‡ªå‹•ç”Ÿæˆ</p>
        <p>â€¢ <strong>æ§‹é€ åŒ–AI:</strong> Geminiæœ€æ–°ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹é«˜ç²¾åº¦ç”Ÿæˆ</p>
      </div>

      <form onsubmit="event.preventDefault();">
        <div class="form-group">
          <label class="form-label" for="prompt">
            <span class="material-symbols-outlined">edit_note</span>
            ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å†…å®¹
            <span class="feature-badge">å¿…é ˆ</span>
          </label>
          <textarea
            id="prompt"
            rows="15"
            placeholder="ä½œæˆã—ãŸã„ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

ãƒ†ã‚¹ãƒˆä¾‹ï¼š
ãƒ»ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ãƒ¼ãƒï¼šã€Œãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®é‡è¦æ€§ã€
ãƒ»è©³ç´°ãªå†…å®¹ï¼š
  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé€²æ—å ±å‘Š
  1. ç¾åœ¨ã®çŠ¶æ³
     - å®Œäº†ã‚¿ã‚¹ã‚¯ï¼šè¨­è¨ˆã€é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º1
     - é€²è¡Œä¸­ï¼šãƒ†ã‚¹ãƒˆã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ
  2. èª²é¡Œã¨å¯¾ç­–
     - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é…å»¶ï¼šãƒªã‚½ãƒ¼ã‚¹è¿½åŠ ã§å¯¾å¿œ
     - å“è³ªä¿è¨¼ï¼šãƒ†ã‚¹ãƒˆå¼·åŒ–
  3. ä»Šå¾Œã®äºˆå®š
     - æ¥æœˆï¼šãƒªãƒªãƒ¼ã‚¹æº–å‚™
     - æ¥ã€…æœˆï¼šæœ¬æ ¼é‹ç”¨é–‹å§‹"
          ></textarea>
        </div>
        <div class="form-group">
          <label class="form-label" for="generate-option">
            <span class="material-symbols-outlined">tune</span>
            è©³ç´°è¨­å®šãƒ»è¦æœ›
            <span class="feature-badge">ä»»æ„</span>
          </label>
          <textarea
            id="generate-option"
            rows="3"
            placeholder="ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®è©³ç´°è¦æœ›ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
ä¾‹ï¼‰ç¤¾å†…ç ”ä¿®ç”¨ã€10åˆ†ç¨‹åº¦ã€å…·ä½“ä¾‹é‡è¦–ã€èãæ‰‹ã¨ã®å¯¾è©±å½¢å¼"
          ></textarea>
        </div>
        <div class="btn-area">
          <button
            type="submit"
            id="test-generate"
            class="submit-btn"
            onclick="handleSubmit(event)"
          >
            <span class="material-symbols-outlined">science</span>ãƒ†ã‚¹ãƒˆç”Ÿæˆ
          </button>
        </div>
      </form>

      <div id="loading">
        <div class="loading-content">
          <div class="spinner"></div>
          <p>ã¾ã˜ã‚“å¼AIãŒã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç”Ÿæˆä¸­...</p>
          <button id="cancel-loading" onclick="cancelLoading()">
            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
          </button>
        </div>
      </div>
      <div id="custom-alert-overlay">
        <div id="custom-alert">
          <div class="alert-content">
            <p id="custom-alert-message">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
            <button onclick="hideCustomAlert()">é–‰ã˜ã‚‹</button>
          </div>
        </div>
      </div>

      <div class="btn-area">
        <button
          id="link-to-slide"
          class="submit-btn"
          onclick="window.open('', '_blank');"
        >
          <span class="material-symbols-outlined">open_in_new</span>
          ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’é–‹ã
        </button>
      </div>
    </div>
    <footer>Â© 2025 ã¾ã˜ã‚“å¼ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ - Powered by Gemini AI</footer>
  </body>
  <script>
    let isCancelled = false; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ•ãƒ©ã‚°

    // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã®å‡¦ç†
    function cancelLoading() {
      isCancelled = true; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
      const loadingElement = document.getElementById("loading");
      if (loadingElement) {
        loadingElement.style.display = "none"; // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’éè¡¨ç¤º
      }
      showCustomAlert("å‡¦ç†ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚");
    }

    async function handleSubmit(event) {
      event.preventDefault(); // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã®ãƒªãƒ­ãƒ¼ãƒ‰ã‚’é˜²æ­¢

      // æŠ¼ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã®IDã‚’å–å¾—
      const buttonId = event.target.id;

      // ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
      const linkButton = document.getElementById("link-to-slide");
      if (linkButton) {
        linkButton.style.display = "none";
      }

      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’è¡¨ç¤º
      const loadingElement = document.getElementById("loading");
      if (loadingElement) {
        loadingElement.style.display = "flex";
      }

      // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—
      const prompt = document.getElementById("prompt")?.value || undefined;
      const generateOption =
        document.getElementById("generate-option")?.value || undefined;

      if (!prompt) {
        if (loadingElement) {
          loadingElement.style.display = "none";
        }
        showCustomAlert("ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å†…å®¹ãŒæœªå…¥åŠ›ã§ã™ã€‚å†…å®¹ã‚’å…¥åŠ›ã—ã¦å†åº¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      // ãƒœã‚¿ãƒ³IDã«å¿œã˜ãŸå‡¦ç†
      let apiMethod;
      if (buttonId === "test-generate") {
        console.log("ãƒ†ã‚¹ãƒˆç”Ÿæˆã‚’å®Ÿè¡Œ");
        apiMethod = "mainCustom"; // ã‚«ã‚¹ã‚¿ãƒ ç”Ÿæˆç”¨ã®Google Apps Scripté–¢æ•°ã‚’ä½¿ç”¨
      } else {
        console.error("ä¸æ˜ãªãƒœã‚¿ãƒ³IDã§ã™");
        if (loadingElement) {
          loadingElement.style.display = "none";
        }
        showCustomAlert("ä¸æ˜ãªæ“ä½œãŒè¡Œã‚ã‚Œã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
        return;
      }

      isCancelled = false; // å‡¦ç†é–‹å§‹æ™‚ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ

      google.script.run
        .withSuccessHandler((response) => {
          if (isCancelled) {
            console.log("ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸãŸã‚å‡¦ç†ã‚’åœæ­¢");
            return;
          }
          console.log("æˆåŠŸ:", response);
          if (loadingElement) {
            loadingElement.style.display = "none";
          }
          showCustomAlert("âœ¨ ã¾ã˜ã‚“å¼ã‚¹ãƒ©ã‚¤ãƒ‰ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nGoogleé¢¨ãƒ‡ã‚¶ã‚¤ãƒ³ã§ç¾ã—ã„ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½œæˆã•ã‚Œã¾ã—ãŸã€‚");
          // ãƒªãƒ³ã‚¯ã‚’æ›´æ–°
          if (linkButton) {
            linkButton.onclick = () => window.open(response, "_blank"); // ãƒªãƒ³ã‚¯ã‚’Google Apps Scriptã®çµæœã«è¨­å®š
            linkButton.style.display = "inline-flex";
          }
        })
        .withFailureHandler((error) => {
          if (isCancelled) {
            console.log("ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸãŸã‚ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’ç„¡è¦–");
            return;
          }
          console.error("ã‚¨ãƒ©ãƒ¼:", error);
          if (loadingElement) {
            loadingElement.style.display = "none";
          }
          showCustomAlert("âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\n\nä»¥ä¸‹ã‚’ã”ç¢ºèªãã ã•ã„ï¼š\nâ€¢ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶š\nâ€¢ Gemini APIè¨­å®š\nâ€¢ å…¥åŠ›å†…å®¹ã®å¦¥å½“æ€§\n\nã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
        })
        [apiMethod](prompt, generateOption); // ãƒ†ã‚¹ãƒˆç”Ÿæˆå®Ÿè¡Œ

      google.script.run.outputLog(prompt, generateOption, buttonId);
    }

    // ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¡¨ç¤ºã™ã‚‹
    function showCustomAlert(message) {
      const alertOverlay = document.getElementById("custom-alert-overlay");
      const alertMessageElement = document.getElementById(
        "custom-alert-message"
      );

      if (alertOverlay && alertMessageElement) {
        alertMessageElement.textContent = message; // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®š
        alertOverlay.style.display = "block"; // åŠé€æ˜ã®è†œã¨ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¡¨ç¤º
      }
    }

    // ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆã‚’éè¡¨ç¤ºã«ã™ã‚‹
    function hideCustomAlert() {
      const alertOverlay = document.getElementById("custom-alert-overlay");
      if (alertOverlay) {
        alertOverlay.style.display = "none"; // éè¡¨ç¤º
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœãªã©ã€å¿…è¦ã«å¿œã˜ã¦è¿½åŠ 
      console.log('ã¾ã˜ã‚“å¼ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼åˆæœŸåŒ–å®Œäº†');
    });
  </script>
</html>